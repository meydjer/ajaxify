// Ajaxify | Fork: https://github.com/meydjer/ajaxify | Original: https://github.com/browserstate/ajaxify
!function(t){var e=t.History,r=t.jQuery,a=t.document;return e.enabled?void r(function(){var i="#primary,article:first,.article:first,.post:first",n=r(i).filter(":first"),l=n.get(0),c=r("#menu,#nav,nav:first,.nav:first").filter(":first"),s="active selected current youarehere",o=".active,.selected,.current,.youarehere",f="> li,> ul > li",d="statechangecomplete",u=r(t),h=r(a.body),p=e.getRootUrl(),g={duration:800,easing:"swing"};0===n.length&&(n=h),r.expr[":"].internal=function(t){var e,a=r(t),i=a.attr("href")||"";return e=i.substring(0,p.length)===p||-1===i.indexOf(":")};var v=function(t){var e=String(t).replace(/<\!DOCTYPE[^>]*>/i,"").replace(/<(html|head|body|title|meta|link|script|noscript|style)([\s\>])/gi,'<div class="document-$1"$2').replace(/<\/(html|head|body|title|meta|link|script|noscript|style)\>/gi,"</div>");return r.trim(e)};r.fn.ajaxify=function(){var t=r(this);return t.find("a:internal:not(.no-ajaxy)").click(function(t){var a=r(this),i=a.attr("href"),n=a.attr("title")||null;return 2==t.which||t.metaKey?!0:(e.pushState(null,n,i),t.preventDefault(),!1)}),t},h.ajaxify(),u.bind("statechange",function(){var y=e.getState(),m=y.url,x=m.replace(p,"");h.addClass("loading"),n.animate({opacity:0},300),r.ajax({url:m,success:function(e){var p,y,j,b=r(v(e)),C=b.find(".document-body:first"),k=C.find(i).filter(":first");if(j=k.find(".document-script"),j.length&&j.detach(),y=k.html()||b.html(),!y)return a.location.href=m,!1;p=c.find(f),p.filter(o).removeClass(s),p=p.has('a[href^="'+x+'"],a[href^="/'+x+'"],a[href^="'+m+'"]'),1===p.length&&p.addClass(s),n.stop(!0,!0),n.html(y).ajaxify().css("opacity",300).show(),a.title=b.find(".document-title:first").text();try{a.getElementsByTagName("title")[0].innerHTML=a.title.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(w){}j.each(function(){var t=r(this),e=t.text(),i=a.createElement("script");t.attr("src")&&(t[0].async||(i.async=!1),i.src=t.attr("src")),i.appendChild(a.createTextNode(e)),l.appendChild(i)}),h.ScrollTo&&h.ScrollTo(g),h.removeClass("loading"),u.trigger(d),"undefined"!=typeof t._gaq&&t._gaq.push(["_trackPageview",x]),"undefined"!=typeof t.reinvigorate&&"undefined"!=typeof t.reinvigorate.ajax_track&&reinvigorate.ajax_track(m)},error:function(){return a.location.href=m,!1}})})}):!1}(window);
